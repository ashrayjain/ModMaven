{% extends "base.html" %}
{% block title %}{{ modName }} - {{modTitle}}{% endblock %}
{% block meta %}
    <meta property="og:type" content="modmaven:module"/>
    <meta property="og:url" content="http://nusmodmaven.appspot.com/modpage?modName={{ modName }}"/>
    <meta property="og:title" content="{{ modName }} - {{ modTitle }}"/>
    <meta property="og:image" content="https://fbstatic-a.akamaihd.net/images/devsite/attachment_blank.png"/>
    <meta property="og:description" content="{{ modDesc }}"/>
{% endblock %}l
{% block main_content %}
    <div class="row-fluid" style="margin-top: 30px">
        <div class="span12">
            <h3 class="pull-left color-head">{{ modName }}</h3>
            <img src="../img/ajax-loader.gif" id="loading-gif"
                 class="pull-right"
                 style="width: 22px; position: relative; top: 21px; right: 123px; visibility: visible">
            <h5 id="login-required" class="pull-right" style="color: #b40100; position: relative; left: 5px; top: 20px; display: none">Login Required</h5>
            <button class="btn btn-small btn-success pull-right" id="interest" style="margin: 18px 0 10px 0; visibility: hidden;">
                Show Interest
            </button>

        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <hr class="color-head" style="margin-top: 5px; margin-bottom: 20px; border-color: #777777">
        </div>
    </div>
    <div class="row-fluid">
        <div id="pills-container">
            <ul class="nav nav-pills" id="pills">
                <li{% if not postSuccess %} class="active"{% endif %}><a href="#Info" data-toggle="pill">Information</a></li>
                <li><a href="#Tree" data-toggle="pill">Tree</a></li>
                <li><a href="#Stats" data-toggle="pill">Statistics</a></li>
                <li{% if postSuccess %} class="active"{% endif %}><a href="#Disc" data-toggle="pill">Discussion</a></li>
            </ul>
            <div class="pill-content">
                <div id="Info" class="pill-pane{% if not postSuccess %} active{% endif %}">
                    <h4>{{modTitle}}</h4>
                    <p class="lead">{{modDesc}}</p>
                </div>
                <div id="Tree" class="pill-pane">
                    {% include 'modal.html' %}
                </div>
                <div id="Stats" class="pill-pane">
                    <p>StatsTabContent</p>
                </div>
                <div id="Disc" class="pill-pane{% if postSuccess %} active{% endif %}">
                    {% if CurrentUser %}
                        {% if postSuccess %}
                            <div class="alert alert-success">
                                Your post has been successfully submitted.
                            </div>
                        {% endif %}
                        <form name="modPost-form" action="/addModPost/" method="post">
                            <fieldset>
                                <label><h5>Make a post: </h5></label>
                                <input type='hidden' name='module' value='{{ modName }}'/>
                                <textarea name="PostContent" id="NewPost" class="input-xxlarge"
                                          rows="3"></textarea><br/>
                                <button type="submit" class="btn btn-primary">Post</button>
                            </fieldset>
                        </form>
                        {% if isModpost %}
                            <div class="row-fluid" id="modulePosts">
                                <p class="lead">Current Discussion:</p>

                                <p>{{ modPosts }}</p>
                                {% for modPost in modPosts %}
                                    <p class="lead">{{ modPost.question }}<br/>
                                        <small>Posted by {{ modPost.askingUser }} at {{ modPost.created }}</small>
                                    </p>
                                    <textarea name="answerBox" id="answerBox" class="input-xlarge"
                                              placeholder="Answer this question.."></textarea>
                                    <button type="button" class="btn btn-primary">Reply</button>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="lead">Be the first to post!</p>
                        {% endif %}
                    {% else %}
                        <p class="text-info"> You need to be logged in to view this content</p>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js %}
    <script src="../js/fb_actions.js"></script>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="../js/tree.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            fbEnsureInit(initializeInterestButton("{{ CurrentUser.access_token }}"));
            $('a[data-toggle="pill"]').on('shown', function (e) {
                if ($(e.target).text() === "Tree" && $(e.relatedTarget).text() !== "Tree") {
                    $.getJSON('/gettree?modName={{ modName }}', function (data) {
                        drawTree(data);
                    });
                }
            });
        });
    </script>
{% endblock %}
